{% load static %}

{% block content %}
<section class="classify-interface" style="padding: 50px 0;">
    <section class="container" style="max-width: 800px; margin: 0 auto;">
        <h1 style="text-align: center; margin-bottom: 30px;">Art Expert AI ðŸŽ¨</h1>
        
        <form method="POST" style="margin-bottom: 40px;">
            {% csrf_token %}
            <div style="position: relative;">
                <textarea class="query-box" 
                          name="query" 
                          style="width: 100%; 
                                 height: 150px; 
                                 padding: 20px; 
                                 border: 2px solid #bf9737; 
                                 border-radius: 4px; 
                                 font-size: 16px; 
                                 resize: vertical;"
                          placeholder="Posez votre question sur l'art ici... Exemple : 'Qui a peint La Jeune Fille Ã  la Perle ?'"></textarea>
                <button type="submit" 
                        style="position: absolute; 
                               right: 20px; 
                               bottom: 20px; 
                               background-color: #bf9737; 
                               color: white; 
                               border: none; 
                               padding: 10px 25px; 
                               border-radius: 4px; 
                               cursor: pointer; 
                               font-size: 16px;">Soumettre</button>
            </div>
        </form>

        {% if response %}
        <div class="response-box" 
             style="background: #f8f9fa; 
                    padding: 25px; 
                    border-radius: 8px; 
                    box-shadow: 0 2px 15px rgba(0,0,0,0.1); 
                    margin-top: 30px;">
            <h3 style="color: #25282e; 
                       border-bottom: 2px solid #bf9737; 
                       padding-bottom: 10px; 
                       margin-bottom: 20px;">RÃ©ponse :</h3>
            <div style="font-size: 16px; 
                       line-height: 1.6; 
                       color: #444;">
                {{ response|linebreaksbr }}
            </div>
        </div>
        {% endif %}
    </section>
</section>

<div id="loading" style="display: none; 
                        position: fixed; 
                        top: 0; 
                        left: 0; 
                        width: 100%; 
                        height: 100%; 
                        background: rgba(255,255,255,0.9); 
                        z-index: 9999; 
                        justify-content: center; 
                        align-items: center;">
    <div style="text-align: center; 
               padding: 30px; 
               background: white; 
               border-radius: 8px; 
               box-shadow: 0 0 20px rgba(0,0,0,0.1);">
        <p style="font-size: 18px; 
                 color: #25282e; 
                 margin-bottom: 15px;">
            Chargement des donnÃ©es artistiques...
        </p>
        <div class="loader" 
             style="border: 4px solid #f3f3f3; 
                    border-top: 4px solid #bf9737; 
                    border-radius: 50%; 
                    width: 30px; 
                    height: 30px; 
                    animation: spin 1s linear infinite; 
                    margin: 0 auto;"></div>
    </div>
</section>

<style>
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .query-box:focus {
        outline: none;
        border-color: #a37d2d;
        box-shadow: 0 0 8px rgba(191, 151, 55, 0.3);
    }

    button:hover {
        background-color: #a37d2d !important;
        transform: translateY(-1px);
    }
</style>

<script>
    let initializationChecks = 0;
    
    function checkInitialization() {
        initializationChecks++;
        fetch('/art/api/check_init/')
            .then(response => response.json())
            .then(data => {
                if (data.initialized) {
                    document.getElementById('loading').style.display = 'none';
                } else if(initializationChecks < 30) { // Timeout aprÃ¨s 60s (30*2s)
                    setTimeout(checkInitialization, 2000);
                } else {
                    document.getElementById('loading').style.display = 'none';
                    alert('Chargement Ã©chouÃ© - Service temporairement indisponible');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('loading').style.display = 'none';
            });
    }
    </script>
{% endblock %}